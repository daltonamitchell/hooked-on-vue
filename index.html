<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hacker News</title>
    <link rel="stylesheet" href="/css/style.css">
  </head>
  <body>
    <div id="app">
      <Navbar></Navbar>
      <main>
        <post-list :posts="posts"></post-list>
      </main>
    </div>

    <script type="text/x-template" id="navbar-template">
      <nav v-once>
        <ul>
          <li class="logo">Hacker News</li>
          <li>new |</li>
          <li>submit</li>
        </ul>
      </nav>
    </script>

    <script type="text/x-template" id="postlist-template">
      <ul class="posts">
        <post
          v-for="(post, index) in sortedPosts"
          :post="post"
          :order="index + 1"
          :key="post.id"
          @upvote="handleUpvote"
        ></post>
      </ul>
    </script>

    <script type="text/x-template" id="post-template">
      <li class="post">
        <span class="text-gray">{{ order }}.</span>
        <span class="upvote text-gray" @click="upvote(post.id)">â–²</span>
        {{ post.description }}
        <span class="text-small text-gray">({{ post.url }})</span>
        <div class="text-small text-gray">{{ post.votes }} votes</div>
      </li>
    </script>

    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script>
      const posts = [{
          "id": 0,
          "description": "The official Vue.js guide",
          "url": "https://vuejs.org",
          "votes": 73
        },
        {
          "id": 1,
          "description": "Vue Router: Dead simple routing for Vue apps",
          "url": "https://router.vuejs.org",
          "votes": 38
        },
        {
          "id": 2,
          "description": "Vuex: A state management library for Vue",
          "url": "https://vuex.vuejs.org",
          "votes": 115
        },
        {
          "id": 3,
          "description": "A most magnificent developer ðŸ˜Ž",
          "url": "https://daltonmitchell.com",
          "votes": 64
        }]

      Vue.component('navbar', {
        template: '#navbar-template'
      })

      Vue.component('post-list', {
        template: '#postlist-template',
        props: {
          posts: Array
        },
        computed: {
          sortedPosts() {
            return this.posts.sort((a, b) => b.votes - a.votes)
          }
        },
        methods: {
          handleUpvote(id) {
            let post = this.posts.find((p) => p.id === id)
            post.votes++
          }
        }
      })

      Vue.component('post', {
        template: '#post-template',
        props: {
          post: Object,
          order: Number
        },
        methods: {
          upvote(id) {
            // let post = this.posts.find((p) => p.id === id)
            // post.votes++
            this.$emit('upvote', id)
          }
        }
      })

      const app = new Vue({
        el: '#app',
        data: {
          posts: posts
        }
      })
    </script>
  </body>
</html>
